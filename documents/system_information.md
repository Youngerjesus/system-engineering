# 시스템 구성 정보 확인하기 

서버를 이루는 중요 리소스들 CPU, memory, 디스크 네트워크 카드 등의 정보를 파악하는 것 위주로 정리했다. 

서버에서 발생하는 이슈가 특정 하드웨어, 특정 펌웨어 버전의 문제일 수도 있고 가장 기본적인 하드웨어 정보를 수집하는 것부터 문제를 해결하는 시작이 될 수 있다.

정리한 내용은 다음과 같다.

## 커널 정보 확인하기 

`uname -a` 옵션을 통해서 커널 정보를 확인할 수 있다. 그리고 `dmesg -a` 를 통해 커널이 부팅할 때 나오는 메시지와 운영중에 발생하 메시지들을 볼 수 있다.

## CPU 정보 확인하기 

리눅스에서는 `dmidecode` 를 통해서 하드웨어 정보를 확인할 수 있다. `dmidecode` 만을 이용하면 너무 많은 정보가 출력되므로 키워드와 함께 사용할 것이 권장된다.

`lscpu` 를 이용하면 cpu 에 대한 정보를 얻을 수 있다. 여기서 출력되는 정보 중 `Sockets` 는 CPU 의 수를 말하며 `Core(s) per socket` 는 cpu 에 있는 코어의 수를 말한다.

`Thread(s) per core` 는 하이퍼스레딩 기술을 적용한 경우 코어당 몇 개의 스레드를 실행할 수 있는지의 정보를 나타내준다.

## 메모리 정보 확인하기 

`dmidecode -t memory` 를 통해서 메모리 정보를 볼 수 있다. 최근에 사용하는 메모리 설계를 NUMA 구조로 했을 경우에는 `Physical Memory Array` 와 `Memory Device` 로 구분되서 보면 된다.

NUMA 는 프로세서와 가까이 있는 메모리가 더 접근성이 좋다는 취지로 나온 설계 방식으로 CPU 에는 로컬 메모리 (Physical Memory Array) 가 각각 붙고 그 안에 Memory Device 가 여러개 붙는 구조다.

여기서 `dmidecode -t memory | grep -i size:` 명령을 하면 Physical Memory Array 에 몇개의 메모리가 꽂혀져 있는지 확인할 수 있다.

그리고 `free -m` 옵션을 통해서 메모리 사용량과 전체 메모리량을 조회할 수 있다.

## 디스크 정보 확인하기

`df -h` 명령을 통해서 디스크 정보를 확인할 수 있다. 각각의 출력되는 라인이 파티션을 말하며 `Mounted On` 에 있는 영역이 파티션이 마운트되어 있는 영역을 말한다.

Filesystem 영역이 각각 다를 수 있는데 `/dev/sda` ,`/dev/hda`, `/dev/vda` 등 다양할 수 있다.

vda 는 가상서버에서 흔히 볼 수 있는 타입이다. 하이퍼바이저에 의해서 동작하는 서버에서 주로 볼 수 있다.

sda 와 hda 의 차이를 간단하게 설명하면 hda 는 개인용 sda 는 서버 운영용이라고 보면 된다.

sda 는 SCSI  방식을 이용해서 확장성이 좋고 접근성이 좋다.

## 네트워크 카드 정보 확인하기

`ethtool eth0` 명령을 통해서 네트워크 카드 정보를 확인할 수 있다.

주로 확인할 수 있는 정보는 해당 네트워크 카드가 보낼 수 있는 속도와 현재 연결되어 있는 속도를 볼 수 있다.

- 현재 속도는 `Speed:` 탭에서 보면 되고 네트워크가 보낼 수 있는 속도는 `Supoorted link modes` 와 `Advertised link modes` 를 통해서 볼 수 있다.

`ethtool -g eth0` 명령을 통해 Ring Buffer 의 크기를 확인할 수 있고 최적화를 할 수 있다.

Ring Buffer 는 케이블을 통해서 들어온 패킷이 가장 먼저 복사되는 곳으로 네트워크 카드에 있는 버퍼 공간이다.

이 영역이 작다면 네트워크 성능 저하를 일으킬 수 있다. 

`ethtool -G eth0 {영역} {값}` (`ethtool -G eth0 rx 255`) 이런 식으로 G 옵션을 통해서 값을 설정할 수 있다.

`ethtool -i eth0` 옵션을 통해 네트워크 카드가 어떤 커널 드라이버를 사용하는지, 버전이 몇인지를 알 수 있다.

 
